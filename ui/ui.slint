import { Button, HorizontalBox, LineEdit, StandardButton, StandardListView, VerticalBox } from "std-widgets.slint";

component ActionButton inherits Rectangle {
    in property<string> label;
    in property<bool> active: true;
    in property<color> accent: #4B4A8B;
    in property<color> inactive: #515151;

    callback clicked;

    min-height: 32px;
    border-radius: 4px;
    border-width: 1px;
    border-color: !active ? inactive.darker(10%) : touch.pressed ? accent.darker(30%) : touch.has-hover ? accent.brighter(30%) : accent.darker(10%);
    background: !active ? inactive : touch.pressed ? accent.darker(25%) : touch.has-hover ? accent.brighter(25%) : accent;

    animate background { duration: 100ms; easing: ease-in-out; }
    animate border-color { duration: 100ms; easing: ease-in-out; }

    touch := TouchArea {
        enabled: active;
        mouse-cursor: active ? pointer : default;
        clicked => { root.clicked(); }
    }

    Text {
        width: 100%;
        height: 100%;
        text: label;
        color: !active ? #999999 : white;
        font-size: 14px;
        horizontal-alignment: center;
        vertical-alignment: center;
    }
}

export component App inherits Window {
    preferred-height: 300px;
    preferred-width: 600px;
    default-font-size: 14px;
    title: "undertasker";
    icon: @image-url("../assets/window.png");

    property<color> enabled: #4B4A8B;
    property<color> disabled: #515151;

    in-out property<int> index: -1;
    in-out property<[StandardListViewItem]> list;
    in-out property<string> path;
    in-out property<length> scroll: 0;
    in-out property<bool> is_not_empty: false;

    callback add(string);
    callback remove();
    callback browse();
    callback save();
    callback run();
    callback show_success;
    callback show_error;

    show_success => { success_popup.show(); }
    show_error => { error_popup.show(); }

    success_popup := PopupWindow {
        height: 100px;
        width: 350px;

        x: ((600px / 1px - 350) / 2) * 1px;
        y: ((350px / 1px - 150) / 2) * 1px;

        Rectangle {
            background: root.background;
            border-color: enabled;
            border-width: 1px;
        }

        success_dialog := Dialog {
            height: 100%;
            width: 100%;

            success_dialog_text := Text {
                text: "The operation was a success.";
                wrap: word-wrap;
            }

            StandardButton { kind: ok; }
        }
    }

    error_popup := PopupWindow {
        height: 100px;
        width: 350px;

        x: ((600px / 1px - 350) / 2) * 1px;
        y: ((350px / 1px - 150) / 2) * 1px;

        Rectangle {
            background: root.background;
            border-color: enabled;
            border-width: 1px;
        }

        error_dialog := Dialog {
            height: 100%;
            width: 100%;

            error_dialog_text := Text {
                text: "An error occurred.";
                wrap: word-wrap;
            }

            StandardButton { kind: ok; }
        }
    }

    VerticalBox {
        HorizontalBox {
            text-edit := LineEdit {
                placeholder-text: "";
                text <=> path;
            }

            ActionButton {
                label: "Add";
                min-width: 80px;
                active: text-edit.text != "";
                clicked => { add(text-edit.text); }
            }
        }

        HorizontalBox {
            Rectangle {
                border-width: 1px;
                border-color: #808080;

                command := StandardListView {
                    width: parent.width;
                    height: parent.height;
                    model: list;
                    current-item <=> index;
                    viewport-y <=> scroll;
                }
            }
        }

        HorizontalBox {
            ActionButton {
                label: "Browse";
                clicked => { browse(); }
            }

            ActionButton {
                label: "Remove";
                active: command.current-item >= 0 && is_not_empty;
                clicked => { remove(); }
            }

            ActionButton {
                label: "Save";
                clicked => { save(); }
            }

            ActionButton {
                label: "Run";
                active: is_not_empty;
                clicked => { run(); }
            }
        }
    }
}
